<script type="text/javascript">

  RED.nodes.registerType('chatbot-listen-lexicon',{
    category: 'RedBot Parsers',
    color: '#FFCC66',
    defaults: {
      name: {
        value: '',
        validate: function(name) {
          return $.RedBot.validate.notEmpty(name);
        }
      },
      values: {
        value: [],
        validate: function(terms) {
          return $.RedBot.validate.arrayNotEmpty(terms);
        }
      },
      outputs: {
        value: 1
      }
    },
    inputs: 1,
    outputs: 1,
    icon: 'chatbot-listen.png',
    paletteLabel: 'Listen Lexicon',
    label: function() {
      return this.name || 'Listen Lexicon';
    },
    oneditsave: function() {
      var domRules = $('#node-input-values-container').editableList('items');
      var node = this;
      var idx;
      // init
      node.values = [];
      // store terms, all lowercase
      for(idx = 0; idx < domRules.length; idx++) {
        var selector = domRules[idx].find('input');
        node.values.push(selector.val().toLowerCase());
      }
    },

    oneditprepare: function() {
      $('#node-input-name')
        .blur(function() {
          var lexiconName = $(this).val();
          lexiconName = lexiconName.replace(/\b\w/g, function(str) {
            return str.toUpperCase();
          }).replace(/ /, '');
          $(this).val(lexiconName);
        });
      $('#node-input-values-container')
        .css('min-width', '450px')
        .editableList({
          addButton: 'Add term',
          addItem: function(container, i, entity) {
            var value = typeof entity == 'object' ? '' : entity;
            var row = $('<div/>').appendTo(container);
            $('<input/>', {
                style: 'width:100%',
                class: 'node-input-rule-property-name',
                type: 'text',
                value: value
              }).appendTo(row);
          },
          removable: true,
          sortable: true
        });
      var values = this.values || [];
      // populate the control
      var idx;
      for (idx = 0; idx < values.length; idx++) {
        $("#node-input-values-container").editableList('addItem', values[idx]);
      }
    },
    oneditresize: function() {
      var dialogForm = $('#dialog-form');
      var rowName = $('.form-row-name', dialogForm);
      var rowLabel = $('.form-row-label', dialogForm);
      var height = dialogForm.height() - rowName.height() - rowLabel.height() - 20;
      $('#node-input-values-container').editableList('height', height);
    }
  });
</script>


<script type="text/x-red" data-template-name="chatbot-listen-lexicon">
<div class="form-row form-row-name">
  <label for="node-input-name"><i class="icon-tag"></i> Name</label>
  <input type="text" id="node-input-name" placeholder="Name">
</div>
<div class="form-row form-row-label" style="margin-bottom:0;">
  <label style="width:100%;"><i class="fa fa-list"></i> <span>Lexicon terms</span></label>
</div>
<div class="form-row node-input-values-container-row">
  <ol id="node-input-values-container"></ol>
</div>
</script>

<script type="text/x-red" data-help-name="chatbot-listen-lexicon">
</script>
